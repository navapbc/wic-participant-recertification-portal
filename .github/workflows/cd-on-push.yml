name: 👉 Deploy on push

on:
  # !! Uncomment the following lines once you've set up the dev environment and ready to turn on continuous deployment
  # push:
  #   branches: ["main"]
  # @DEBUG
  workflow_dispatch:
  push:
    branches: ["PRP-166-cd-connect-the-infrastructure"]


jobs:
  deploy_app:
    name: 🪴 Deploy only changed apps
    runs-on: ubuntu-latest
    steps:
      - name: ⬇️ Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # To retrieve the preceding commit

      - name: 📬 Get changed files in the participant_portal folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: participant_portal

      - name: 📬📦 Deploy participant_portal if there are changes
        if: steps.changed-files-participant.outputs.any_changed == 'true'
        uses: ./.github/workflows/cd.yml
        with:
          app_name: participant_portal

      - name: 📨 Get changed files in the staff_portal folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: staff_portal

      - name: 📨📦 Deploy staff_portal if there are changes
        if: steps.changed-files-participant.outputs.any_changed == 'true'
        uses: ./.github/workflows/cd.yml
        with:
          app_name: staff_portal

      - name: 📊 Get changed files in the analytics folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: analytics

      - name: 📊📦 Deploy analytics if there are changes
        if: steps.changed-files-participant.outputs.any_changed == 'true'
        uses: ./.github/workflows/cd.yml
        with:
          app_name: analytics
