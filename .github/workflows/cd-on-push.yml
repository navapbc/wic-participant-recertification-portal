name: 👉 Deploy on push

on:
  # !! Uncomment the following lines once you've set up the dev environment and ready to turn on continuous deployment
  # push:
  #   branches: ["main"]
  # @DEBUG
  workflow_dispatch:
  push:
    branches: ["PRP-166-cd-connect-the-infrastructure"]


jobs:
  check_participant:
    name: 🔎 Check participant
    runs-on: ubuntu-latest
    outputs:
      has_changed: ${{ steps.changed-files-participant.outputs.any_changed }}
    steps:
      - name: ⬇️ Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # To retrieve the preceding commit

      - name: 🗂 Get changed files in the participant_portal folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: participant_portal

      - name: 📋 List participant_portal that have changed
        run: |
          echo "List all the files that have changed: ${{ steps.changed-files-participant.outputs.all_changed_files }}"


  deploy_participant:
    name: 📬 Deploy participant
    needs: check_participant
    if: ${{ needs.check_participant.outputs.has_changed  == 'true'}}
    uses: ./.github/workflows/cd.yml
    with:
      app_name: participant_portal

  # deploy_staff:
  #   name: 📨 Deploy staff portal if there are changes
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: ⬇️ Checkout repo
  #       uses: actions/checkout@v3
  #       with:
  #         fetch-depth: 2  # To retrieve the preceding commit

  #     - name: 🗂 Get changed files in the staff_portal folder
  #       id: changed-files-staff
  #       uses: tj-actions/changed-files@v35
  #       with:
  #         files: staff_portal

  #     - name: 📦 Deploy staff_portal if there are changes
  #       if: steps.changed-files-staff.outputs.any_changed == 'true'
  #       uses: ./.github/workflows/cd.yml
  #       with:
  #         app_name: staff_portal

  # deploy_analytics:
  #   name: 📊 Deploy analytics if there are changes
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: ⬇️ Checkout repo
  #       uses: actions/checkout@v3
  #       with:
  #         fetch-depth: 2  # To retrieve the preceding commit

  #     - name: 🗂 Get changed files in the analytics folder
  #       id: changed-files-analytics
  #       uses: tj-actions/changed-files@v35
  #       with:
  #         files: analytics

  #     - name: 📦 Deploy analytics if there are changes
  #       if: steps.changed-files-analytics.outputs.any_changed == 'true'
  #       uses: ./.github/workflows/cd.yml
  #       with:
  #         app_name: analytics
