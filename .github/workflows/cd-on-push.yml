name: ğŸ‘‰ Deploy on push

on:
  # !! Uncomment the following lines once you've set up the dev environment and ready to turn on continuous deployment
  # push:
  #   branches: ["main"]
  # @DEBUG
  workflow_dispatch:
  push:
    branches: ["PRP-166-cd-connect-the-infrastructure"]


jobs:
  deploy_app:
    name: ğŸª´ Deploy only changed apps
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # To retrieve the preceding commit

      - name: ğŸ“¬ Get changed files in the participant_portal folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: participant_portal

      - name: ğŸ“¬ğŸ“¦ Deploy participant_portal if there are changes
        if: steps.changed-files-participant.outputs.any_changed == 'true'
        uses: ./.github/workflows/cd.yml
        with:
          app_name: participant_portal

      - name: ğŸ“¨ Get changed files in the staff_portal folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: staff_portal

      - name: ğŸ“¨ğŸ“¦ Deploy staff_portal if there are changes
        if: steps.changed-files-participant.outputs.any_changed == 'true'
        uses: ./.github/workflows/cd.yml
        with:
          app_name: staff_portal

      - name: ğŸ“Š Get changed files in the analytics folder
        id: changed-files-participant
        uses: tj-actions/changed-files@v35
        with:
          files: analytics

      - name: ğŸ“ŠğŸ“¦ Deploy analytics if there are changes
        if: steps.changed-files-participant.outputs.any_changed == 'true'
        uses: ./.github/workflows/cd.yml
        with:
          app_name: analytics
