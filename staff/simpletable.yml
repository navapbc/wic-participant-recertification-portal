id: test # Lowdefy page ID
type: PageHeaderMenu # Lowdefy page type

requests: # Requests defines all the data requests made available in this page context
  - id: get_data
    type: KnexBuilder
    connectionId: postgres
    properties:
      query:
        - select:
          - submissions.updated_at
          - local_agencies.name as agency_name
        - from:
          - submissions
        - leftJoin:
          - submission_forms
          - submission_forms.submission_id
          - '='
          - submissions.submission_id
        - leftJoin:
          - local_agencies
          - submissions.local_agency_id
          - '='
          - local_agencies.local_agency_id

events:
  onInitAsync: # A list of actions that gets completed each time a user visits this page
    - id: fetch_data
      type: Request
      params: get_data # Execute the `get_data` request

blocks:
  - id: table
    type: AgGridAlpine # A supporting component type that uses https://www.ag-grid.com
    properties:
      rowData:
        _request: get_data
        # - title: One more thing
        #   year: 2010
        #   viewerReviews: 30
        # - title: Two stuff
        #   year: 2011
        #   viewerReviews: 20
      defaultColDef: # The table columns are sortable, resizable, and filterable
        sortable: true
        resizable: true
        filter: true
      columnDefs:
        - headerName: Title
          valueGetter:
            _function:
              __log:
                - __args: 0.data.agency_name
                # - __args: 0.data.updated_at
  - id: testwhy
    type: Paragraph
    properties:
      content: >-
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat.
