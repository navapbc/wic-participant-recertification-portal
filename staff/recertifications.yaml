id: recertifications
type: PageHeaderMenu

requests:
  - id: get_data
    type: KnexRaw
    connectionId: postgres
    properties:
      query: SELECT * FROM recertifications;

events:
  # A list of actions that gets completed each time a user visits this page.
  onInitAsync:
    - id: fetch_data
      type: Request
      params: get_data # Fetch the brands data query each time a user enter this page.

blocks:
  - id: my_table
    type: AgGridAlpine
    properties:
      rowData:
        _request: get_data.rows
      defaultColDef:
        sortable: true
        resizable: true
        filter: true
      columnDefs:
        - headerName: Submission date
          field: created_at
          width: 350
          valueFormatter:
            _function:
              __format.intlDateTimeFormat:
                on:
                  __args: 0.value
                params:
                  options:
                    dateStyle: "short"
                    timeStyle: "long"
        - headerName: Participant
          field: participant
          width: 400
        - headerName: Household ID
          field: household_id
          width: 300
        - headerName: Nutrition notes
          field: nutrition_notes
          width: 500
    events:
      onRowClick:
        - id: set_selected
          type: SetState
          params:
            selected_row: # Update 'selected' in state with the event data.
              _event: row
  - id: selection
    type: Paragraph
    properties:
      level: 4
      content:
        _if: # Show the event data in a title, or call to action.
          test:
            _eq:
              - _state: selected_row
              - null
          else:
            _string.concat:
              - "Participant: "
              - _state: selected_row.participant
              - ", Household ID: "
              - _state: selected_row.household_id
